<!DOCTYPE html>
<html>

<head>
    <title>Goods.com</title>
    <link rel="stylesheet" type="text/css" href="assets/style.css"/>

    <style>

        #searchBar 
        {
         width: 600px; /* Adjust the width as needed */
        }

        .navBar input[type="text"] {
          width: 600px;
        }

        h1 {
            text-align: center;
            margin: 20px;
        }

        /* Center the content using flexbox */
        .status-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }

        #satisfactionFormContainer {
            margin-top: 20px;
        }

    </style>
    
</head>

<body>
    <div class="navBar">

        <img id="logo" src="assets/goods_logo.png" alt="alternative text"/>
        <button type="submit">Search<i class="fa-search"></i></button>
        <input type="text" placeholder="Search for products in goods.com" />

        <div id="listing">
            <ul>
                <a href="/account.html">Account</a>
                <a href="/cart.html">Cart</a>
                <a href="/status.html">Your orders</a>
                <a href="/index.html"> Main </a>
                <a href="/geoLocation.html"> Tracking </a>        
              </ul>
          </div>
    </div>

    <div id="loginContainer">
        <input type="text" id="usernameInput" placeholder="Enter Username" />
        <input type="password" id="passwordInput" placeholder="Enter Password" />
        <button type="button" onclick="fetchUserID()">Fetch UserID</button>
    </div>


    <div class="status-container" id="OrderStatusContainer">
        <h1 id="OrderStatusHeader">Order Status</h1>
        <div id="orderStatus"></div>
    </div>

    <div class="status-container" id="ShippingStatusContainer">
        <h1 id="ShippingStatusHeader">Shipping Status</h1>
        <div id="shippingStatus"></div>
        <div id="satisfactionFormContainer"></div>
    </div>

    <div class="status-container" id="TrackingCodeContainer">
        <h1 id="TrackingCodeHeader">Tracking Code</h1>
        <div id="trackingCode"></div>
    </div>

    <div class="status-container" id="ShippingProviderContainer">
        <h1 id="ShippingProviderHeader">Shipping Provider</h1>
        <div id="shippingProvider"></div>
    </div>

  <script>

    async function fetchUserID() 
    {
        try 
        {

            // Fetch user list and password list
            const response7 = await fetch('/usernames');
            const userLIST = await response7.json();


            console.log("USERNAMES");
            console.log(userLIST);

            const response8 = await fetch('/passwords');
            const passwordLIST = await response8.json();

            console.log("PASSWORDS");
            console.log(passwordLIST);

            const response9 = await fetch('/userID');
            const userIDList = await response9.json();

            // Get the username and password from input fields
            const usernameInput = document.getElementById('usernameInput');
            const passwordInput = document.getElementById('passwordInput');
            const username = usernameInput.value;
            const password = passwordInput.value;

            console.log("USERNAMES");
            console.log(username);
            console.log("PASSWORD");
            console.log(password);

            // Check if username and password match a specific user
            const index = userLIST.indexOf(username);
            if (index !== -1 && passwordLIST[index] === password) 
            {
                // Fetch the corresponding user's userID
                const iD = userIDList[index];
                // Display user's information based on userID
                fetchStatus(iD);
            } 
            else 
            {
                console.log('Invalid username or password');
            }
        } 
        catch (error) 
        {
            console.error(error);
        }
    }
    async function fetchStatus(index) {

        index=index-1;
        try 
        {
            const response1 = await fetch('/orderStatus');
            const data1 = await response1.json();
            const orderStatus = data1[index];

            const response2 = await fetch('/shippingStatus');
            const data2 = await response2.json();
            const shippingStatus = data2[index];

            const response3 = await fetch('/userID');
            const data3 = await response3.json();
            const userID = data3[index];

            const response4 = await fetch('/completionConfirmation');
            const data4 = await response4.json();
            const completionConfirmation = data4[index];

            const response5 = await fetch('/trackingCODES');
            const data5 = await response5.json();
            const trackingCode = data5[index];

            const response6 = await fetch('/shippingProvider');
            const data6 = await response6.json();
            const shippingProvider = data6[index];

            // Display elements based on conditional statements
            if (orderStatus === 'IN PROGRESS' && shippingStatus === 'ASSEMBLY') 
            {

                document.getElementById('orderStatus').innerText = JSON.stringify(orderStatus);
                document.getElementById('shippingStatus').innerText = JSON.stringify(shippingStatus);
                document.getElementById('shippingProvider').innerText = "NaN";
                document.getElementById('trackingCode').innerText = "NaN";

            } 
            else if (orderStatus === 'IN PROGRESS' && shippingStatus === 'SHIPPING') 
            {

                document.getElementById('orderStatus').innerText = JSON.stringify(orderStatus);
                document.getElementById('shippingStatus').innerText = JSON.stringify(shippingStatus);
                document.getElementById('shippingProvider').innerText = JSON.stringify(shippingProvider);
                document.getElementById('trackingCode').innerText = JSON.stringify(trackingCode);

                //WITHIN THIS CODE NEED TO MAKE IT SO THAT THERE IS A BUTTON THAT CAN BE PRESSED TO CANCEL AN ORDER

            } 
            else if (orderStatus === 'NO ORDER') 
            {

                document.getElementById('orderStatus').innerText = JSON.stringify(orderStatus);
                document.getElementById('shippingStatus').innerText = "NaN";
                document.getElementById('shippingProvider').innerText = "NaN";
                document.getElementById('trackingCode').innerText = "NaN";
                
            }
            else if (orderStatus == 'CANCELED')
            {

                document.getElementById('orderStatus').innerText = "NaN";
                document.getElementById('shippingStatus').innerText = "NaN";
                document.getElementById('shippingProvider').innerText = "NaN";
                document.getElementById('trackingCode').innerText = "NaN";

            }
            else if (orderStatus == 'IN PROGRESS' && shippingStatus == 'COMPLETE')
            {
                document.getElementById('orderStatus').innerText = "NaN";
                document.getElementById('shippingStatus').innerText = JSON.stringify(shippingStatus);
                document.getElementById('shippingProvider').innerText = "NaN";
                document.getElementById('trackingCode').innerText = "NaN";
                
                index=index+1;
                displaySatisfactionForm(index);

            }

        } 
        catch (error) 
        {
            console.error(error);
        }
    }

    function displaySatisfactionForm(index) 
    {
        // Create the satisfaction form dynamically
        const satisfactionForm = document.createElement('form');
        satisfactionForm.id = 'userSatisfactionForm';

        const satisfactionLabel = document.createElement('label');
        satisfactionLabel.textContent = 'Rate your satisfaction on a scale from 1 to 10:';
        satisfactionForm.appendChild(satisfactionLabel);

        const satisfactionInput = document.createElement('input');
        satisfactionInput.type = 'number';
        satisfactionInput.id = 'satisfaction';
        satisfactionInput.name = 'satisfaction';
        satisfactionInput.min = '1';
        satisfactionInput.max = '10';
        satisfactionInput.required = true;
        satisfactionForm.appendChild(satisfactionInput);

        const submitButton = document.createElement('input');
        submitButton.type = 'submit';
        submitButton.value = 'Submit Feedback';
        satisfactionForm.appendChild(submitButton);

        // Append the form to the satisfaction form container
        document.getElementById('satisfactionFormContainer').appendChild(satisfactionForm);

        // Add event listener for form submission
        satisfactionForm.addEventListener('submit', function (event) {
        handleSatisfactionFormSubmit(event, index);
    });
    }

    function handleSatisfactionFormSubmit(event,index) 
    {
        event.preventDefault();

        // Retrieve the satisfaction rating from the form
        const satisfactionRating = document.getElementById('satisfaction').value;

        // Perform further actions with the satisfaction rating, e.g., send to the server
        updateSatisfactionRating(satisfactionRating,index);
    }

    async function updateSatisfactionRating(satisfactionRating,index) 
    {
        fetch('/updateSatisfactionRating', {
        method: 'POST',
        headers: {
        'Content-Type': 'application/json',
        },
        body: JSON.stringify({ id: index, opinionQuery: satisfactionRating }),
        })
        .then((response) => response.json())
        .then((data) => {
        if (data.success) {
            console.log('Satisfaction rating updated successfully');
        } else {
            console.error('Error updating satisfaction rating:', data.error);
        }
        })
        .catch((error) => {
        console.error('Error updating satisfaction rating:', error);
        });
    }

  </script>
</body>
</html>